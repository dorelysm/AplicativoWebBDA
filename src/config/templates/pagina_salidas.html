{% extends "layout.html" %}

{%  block content %}
<nav class="navbar navbar-light bg-light">
  <a class="navbar-brand" href="#">
    <img src="https://pastoralsocialbaq.org/wp-content/uploads/2016/07/LOGO-BANCO-ALIMENTOS.png" width="150" height="100" class="d-inline-block align-top" alt=""> </a>
  <h1>Sistema de gesti√≥n de donaciones</h1>
  <a href="/cerrar" class="btn btn-danger"> Salir</a>
</nav>

{% include('modal.html') %}

<a href="\pagina_entradas" class="btn btn-primary">Entradas</a>
<a href="\pagina_salidas" class="btn btn-primary">Salidas</a>
<a onclick="cargar_formulario()" class="btn btn-success"  data-bs-toggle="modal" data-bs-target="#staticBackdrop">Nueva salida</a>

<h2>Salidas</h2>

<table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Id salida</th>
        <th scope="col">Id beneficiario</th>
        <th scope="col">Id entrada</th>
        <th scope="col">Fecha</th>
        <th scope="col">Bodega</th>
        <th scope="col">Cantidad (peso)</th>
        <th scope="col">Cantidad (unidades)</th>
        <th scope="col">Unidad de medidas</th>
        <th scope="col">Aporte solidario</th>
        <th scope="col">Observaciones</th>
        <th scope="col" colspan="2"><center>Opciones</center></th>
      </tr>
    </thead>
    <tbody>
            {% for item in salidas %}
            <tr>
                <th scope="row">{{item.id}}</th>
                <td>{{item.id_beneficiario}}</td>
                <td>{{item.id_entrada}}</td>
                <td>{{item.fecha}}</td>
                <td>{{item.bodega}}</td>
                <td>{{item.cantidad_peso}}</td>
                <td>{{item.cantidad_unidades}}</td>
                <td>{{item.unidad_de_medida}}</td>
                <td>{{item.aporte_solidario}}</td>
                <td>{{item.observaciones}}</td>
                <td><a onclick="actualizar('{{item.id}}')"  data-bs-toggle="modal" data-bs-target="#staticBackdrop" class="btn btn-primary btn-sm rounded-0" >Actualizar</a></td>
                <td><a onclick="eliminar('{{item.id}}')" class="btn btn-danger btn-sm rounded-0">eliminar</a></td>
            </tr>
            {% endfor %}
    </tbody>
  </table>

  <script>
    function cargar_formulario(){
        const formulario = `
                <form action="/guardar_salida" method="POST">
                  <div class="form-group">
                    <label for="recipient-name" class="col-form-label">Id del beneficiario:</label>
                    <input type="text" class="form-control" name="id_beneficiario"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Id de la entrada:</label>
                    <input type="text" class="form-control" name="id_entrada"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Fecha:</label>
                    <input type="text" class="form-control" name="fecha"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Bodega:</label>
                    <input type="text" class="form-control" name="bodega"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Cantidad (peso):</label>
                    <input type="text" class="form-control" name="cantidad_peso"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Cantidad (unidades):</label>
                    <input type="text" class="form-control" name="cantidad_unidades"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Unidad de medida:</label>
                    <input type="text" class="form-control" name="unidad_de_medida"  value="">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Aporte solidario:</label>
                    <input type="text" class="form-control" name="aporte_solidario"  value="">
                  </div>                  
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Observaciones:</label>
                    <input type="text" class="form-control" name="observaciones"  value="">
                  </div>
                  <div class="modal-footer">
                    <button  type="submit" class="btn btn-primary">Guardar</button>
                  </div>
                </form> 
        `;
        $("#fromartc").html(formulario);
    }   
    
    function eliminar(id){
        url = '/eliminar_salida';
        var request = $.ajax({
            contentType:"application/json",
            dataType: "json", //Expected data format from server  
            method: "GET",
            data: { id},
            url: url      
        });
        request.done(function( data ) {
            alert("Datos Eliminado")
            window.location.href = "/pagina_entradas";                
        });
        request.fail(function( jqXHR, textStatus ) {
            alert( "Error" + textStatus );
        });
    }

    
    function actualizar(id){
        url = '/salidas';
        var request = $.ajax({
            contentType:"application/json",
            dataType: "json", //Expected data format from server  
            method: "GET",
            data: { id},
            url: url      
        });
        request.done(function( data ) {
            const formulario = `
                <form action="/actualizar_salida" method="POST">
                    <input type="hidden" class="form-control" name="id"  value="${data.id}">
                  <div class="form-group">
                    <label for="recipient-name" class="col-form-label">Id del beneficiario:</label>
                    <input type="text" class="form-control" name="id_beneficiario"  value="${data.id_beneficiario}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Id de la entrada:</label>
                    <input type="text" class="form-control" name="id_entrada"  value="${data.id_entrada}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Fecha:</label>
                    <input type="text" class="form-control" name="fecha"  value="${data.fecha}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Bodega:</label>
                    <input type="text" class="form-control" name="bodega"  value="${data.bodega}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Cantidad (peso):</label>
                    <input type="text" class="form-control" name="cantidad_peso"  value="${data.cantidad_peso}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Cantidad (unidades):</label>
                    <input type="text" class="form-control" name="cantidad_unidades"  value="${data.cantidad_unidades}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Unidad de medida:</label>
                    <input type="text" class="form-control" name="unidad_de_medida"  value="${data.unidad_de_medida}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Aporte solidario:</label>
                    <input type="text" class="form-control" name="aporte_solidario"  value="${data.aporte_solidario}">
                  </div>
                  <div class="form-group">
                    <label for="message-text" class="col-form-label">Observaciones:</label>
                    <input type="text" class="form-control" name="observaciones"  value="${data.observaciones}">
                  </div>
                  <div class="modal-footer">
                    <button  type="submit" class="btn btn-primary">Guardar</button>
                  </div>
                </form> 
        `;
        $("#fromartc").html(formulario);             
        });
        request.fail(function( jqXHR, textStatus ) {
            alert( "Error" + textStatus );
        });
    }

 </script>

{% endblock %}