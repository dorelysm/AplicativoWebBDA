{% extends "layout.html" %}

{%  block content %}

{% include('modal.html') %}

<main>
    <div class="container-fluid px-4">
      <h1 class="mt-4">Productos</h1>
      
      <div class="card mb-4">
        <div class="card-header">
          <i class="fas fa-table me-1"></i>
          Listado de productos
        </div>
        <div class="card-body">
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Id</th>
                  <th scope="col">Id subcategoria</th>
                  <th scope="col">Descripcion</th>
                  <th scope="col">Peso (Kg)</th>
                  <th scope="col" colspan="2"><center>Opciones</center></th>
                </tr>
              </thead>
              <tbody>
                {% for item in productos %}
                <tr>
                  <th scope="row">{{item.id}}</th>
                  <td>{{item.subcategoria}}</td>
                  <td>{{item.descripcion}}</td>
                  <td>{{item.peso}}</td>
                  <td>
                    <a
                      onclick="actualizar('{{item.id}}')"
                      data-bs-toggle="modal"
                      data-bs-target="#staticBackdrop"
                      class="btn btn-primary btn-sm rounded-0"
                      >Actualizar</a
                    >
                  </td>
                  <td>
                    <a
                      onclick="eliminar('{{item.id}}')"
                      class="btn btn-danger btn-sm rounded-0"
                      >eliminar</a
                    >
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <script>
              function cargar_formulario(){
                const formulario = `
                <form action="/nuevo_producto" method="POST">
                    <div class="form-group">
                      <label for="recipient-name" class="col-form-label">Id subcategoria:</label>
                      <select class="form-control" name="subcategoria">
                        {% for item in subcategorias %}
                        <option>{{item.descripcion}}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="recipient-name" class="col-form-label">Descripcion:</label>
                      <input type="text" class="form-control" name="descripcion"  value="">
                    </div>
                    <div class="form-group">
                      <label for="recipient-name" class="col-form-label">Peso (Kg):</label>
                      <input type="text" class="form-control" name="peso"  value="">
                    </div>
                    <div class="modal-footer">
                      <button  type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                  </form> 
                `;
                $("#fromartc").html(formulario);
            }

              function eliminar(id) {
                url = "/eliminar_producto";
                var request = $.ajax({
                  contentType: "application/json",
                  dataType: "json", //Expected data format from server
                  method: "GET",
                  data: { id },
                  url: url,
                });
                request.done(function (data) {
                  alert("Datos Eliminado");
                  window.location.href = "/pagina_productos";
                });
                request.fail(function (jqXHR, textStatus) {
                  alert("Error" + textStatus);
                });
              }

              function actualizar(id){
                url = '/productos';
                var request = $.ajax({
                    contentType:"application/json",
                    dataType: "json", //Expected data format from server  
                    method: "GET",
                    data: { id},
                    url: url      
                });
                request.done(function( data ) {
                    const formulario = `
                        <form action="/actualizar_producto" method="POST">
                            <input type="hidden" class="form-control" name="id"  value="${data.id}">
                            <div class="form-group">
                                <label for="recipient-name" class="col-form-label">Id subcategoria:</label>
                                <select class="form-control" name="subcategoria">
                                  {% for item in subcategorias %}
                                  <option>{{item.descripcion}}</option>
                                  {% endfor %}
                                </select>
                              </div>
                              <div class="form-group">
                                <label for="recipient-name" class="col-form-label">Descripcion:</label>
                                <input type="text" class="form-control" name="descripcion"  value="">
                              </div>
                              <div class="form-group">
                                <label for="recipient-name" class="col-form-label">Peso (Kg):</label>
                                <input type="text" class="form-control" name="peso"  value="">
                              </div>
                          <div class="modal-footer">
                            <button  type="submit" class="btn btn-primary">Guardar</button>
                          </div>
                        </form> 
                `;
                $("#fromartc").html(formulario);             
                });
                request.fail(function( jqXHR, textStatus ) {
                    alert( "Error" + textStatus );
                });
            }

            </script>
          </div>
        </div>
      </div>
    </div>
  </main>

{% endblock %}